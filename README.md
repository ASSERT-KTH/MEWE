# MEWE

MEWE is a toolset tailored to provide multivariant execution at the Edge. It uses an extended LLVM linker, CROW and the Fastly ABI to provide multivariant binaries that be successfully deployed to the Fastly's platform.

# Repository structure
 - `multivariant-mixer`: The MEWE mulrivariant library generator.
 - `link_sodium`, `link_qrcode`: MEWE pipelines for Fastly edge deployment. 
 - `experiments`: scripts for experiments reproduction


## Extended linker or "mixer"
[![mewe linker](https://github.com/Jacarte/MEWE/actions/workflows/build_linker.yaml/badge.svg?branch=main)](https://github.com/Jacarte/MEWE/actions/workflows/build_linker.yaml)

**multivariant-mixer**

We merge several libraries into a big one, we call it a multivariant l ibrary. It is a big library containing semantically equivalent functions (yet statically different) for which we orchestrate their execution at runtime. `mixer` creates LLVM multivariant libraries out of a collection of LLVM libraries as input.

[Read more about it [here](multivariant-mixer)]
 
### MEWE multivariants:

Once with the mixer, you can start creating multivariant libraries. To do so, you need to be able of creating semantically equivalent functions out of the original library. A previous [work of us](https://github.com/KTH/slumps/tree/master/crow), uses a superoptimizer to create a handful number of variants out of a single LLVM bitcode. We would like to remark that this approach will work with any diversifier, as soon as it fits with `mixer` in terms of binary correctness. 

We created a proof of concept of deploying multivariants at the Edge, specifically at the Fastly platform. We create multivariant libraries for `libsodium` and a `qrcode_generator`. We then pass these multivariant binaries to the `rustc` compiler to generate a valid executable Wasm binary (according to the Fastly ABI). We enumerate the roadmap in the following.

1 - Each pipeline folder(`link_sodium` and `link_qrcode`) contains the corresponding scripting to collect the LLVM bitcodes to diversify and merge with MEWE:
- **link_qrcode**: In this case we intercept the intermediate bitcodes generated by rustc, and we then take them as the target for diversification. By running `python rust/build.py`, we collect them.

- **link_sodium**: We take the bitcode generated from the compilation of the libsodium project as the target for diversification. The file could be found at `inlined/original/allinone.bc`.

2 - For each pipeline folder, the collected bitcodes need to be diversified. We use CROW for such task, we pass them to CROW and we collect the generated variants.

3 - After collecting the variants we merge them with `mixer`.

4 - The multivariant libraries can be then used by any LLVM-like compiler. In our research, we use `rustc` to link the multivariant libraries to 7 endpoints to be deployed as functions in the Fastly's platform. 
